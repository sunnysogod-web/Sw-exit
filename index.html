<!DOCTYPE html>
<html lang="th" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡∏ö‡πâ‡∏≤‡∏ô‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ß‡∏±‡∏ô</title>
  <script src="https://cdn.tailwindcss.com/3.4.17"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  
  <style>
    body {
      box-sizing: border-box;
      font-family: 'Kanit', sans-serif;
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }
    
    @keyframes bounce-slow {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-5px); }
    }
    
    @keyframes wiggle {
      0%, 100% { transform: rotate(-3deg); }
      50% { transform: rotate(3deg); }
    }
    
    @keyframes pulse-glow {
      0%, 100% { box-shadow: 0 0 5px rgba(59, 130, 246, 0.5); }
      50% { box-shadow: 0 0 20px rgba(59, 130, 246, 0.8); }
    }
    
    .float-animation {
      animation: float 3s ease-in-out infinite;
    }
    
    .bounce-slow {
      animation: bounce-slow 2s ease-in-out infinite;
    }
    
    .wiggle {
      animation: wiggle 2s ease-in-out infinite;
    }
    
    .pulse-glow {
      animation: pulse-glow 2s ease-in-out infinite;
    }
    
    .gradient-bg {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    .school-pattern {
      background-color: #f0f9ff;
      background-image: 
        radial-gradient(circle at 20% 80%, rgba(59, 130, 246, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(147, 51, 234, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 40% 40%, rgba(34, 197, 94, 0.08) 0%, transparent 30%);
    }
    
    .card-shadow {
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1), 0 0 0 1px rgba(255, 255, 255, 0.5) inset;
    }
    
    .notification-badge {
      animation: pulse-glow 1.5s ease-in-out infinite;
    }
    
    .custom-scrollbar::-webkit-scrollbar {
      width: 6px;
    }
    
    .custom-scrollbar::-webkit-scrollbar-track {
      background: #f1f5f9;
      border-radius: 10px;
    }
    
    .custom-scrollbar::-webkit-scrollbar-thumb {
      background: #94a3b8;
      border-radius: 10px;
    }
    
    .toast {
      transform: translateX(100%);
      transition: transform 0.3s ease-out;
    }
    
    .toast.show {
      transform: translateX(0);
    }
  </style>
</head>
<body class="h-full overflow-auto school-pattern">
  <div id="app" class="min-h-full w-full">
    
    <!-- Toast Notification Container -->
    <div id="toast-container" class="fixed top-4 right-4 z-50 space-y-2"></div>
    
    <!-- Login Page -->
    <div id="login-page" class="min-h-full flex items-center justify-center p-4">
      <div class="w-full max-w-md">
        <!-- Decorative Elements -->
        <div class="relative mb-8">
          <div class="absolute -top-16 -left-8 text-6xl float-animation" style="animation-delay: 0s;">üìö</div>
          <div class="absolute -top-12 -right-4 text-5xl float-animation" style="animation-delay: 0.5s;">üéí</div>
          <div class="absolute -top-20 left-1/2 text-4xl float-animation" style="animation-delay: 1s;">‚úèÔ∏è</div>
        </div>
        
        <div class="bg-white/90 backdrop-blur-lg rounded-3xl card-shadow p-8 border border-white/50">
          <!-- School Logo/Icon -->
          <div class="text-center mb-6">
            <div class="inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full shadow-lg mb-4">
              <span class="text-4xl">üè´</span>
            </div>
            <h1 id="school-title" class="text-2xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">
              ‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡∏ö‡πâ‡∏≤‡∏ô‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ß‡∏±‡∏ô
            </h1>
            <p class="text-gray-500 mt-2">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</p>
          </div>
          
          <!-- Login Type Tabs -->
          <div class="flex bg-gray-100 rounded-2xl p-1 mb-6">
            <button onclick="switchLoginType('student')" id="tab-student" class="flex-1 py-3 px-4 rounded-xl font-medium transition-all duration-300 bg-white shadow-md text-blue-600">
              üéì ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
            </button>
            <button onclick="switchLoginType('teacher')" id="tab-teacher" class="flex-1 py-3 px-4 rounded-xl font-medium transition-all duration-300 text-gray-500 hover:text-gray-700">
              üë®‚Äçüè´ ‡∏Ñ‡∏£‡∏π/‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£
            </button>
          </div>
          
          <!-- Student Login Form -->
          <form id="student-login-form" onsubmit="handleStudentLogin(event)" class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                <span class="mr-2">üî¢</span>‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
              </label>
              <input type="text" id="student-id" required placeholder="‡πÄ‡∏ä‡πà‡∏ô 12345" 
                class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:ring-4 focus:ring-blue-100 transition-all outline-none">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                <span class="mr-2">ü™™</span>‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô (4 ‡∏ï‡∏±‡∏ß‡∏ó‡πâ‡∏≤‡∏¢)
              </label>
              <input type="password" id="student-id-card" required placeholder="‡πÄ‡∏ä‡πà‡∏ô 1234" maxlength="4"
                class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:ring-4 focus:ring-blue-100 transition-all outline-none">
            </div>
            <button type="submit" class="w-full py-4 bg-gradient-to-r from-blue-500 to-blue-600 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all duration-300">
              ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö üöÄ
            </button>
          </form>
          
          <!-- Teacher Login Form -->
          <form id="teacher-login-form" onsubmit="handleTeacherLogin(event)" class="space-y-4 hidden">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                <span class="mr-2">üë§</span>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
              </label>
              <input type="text" id="teacher-username" required placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ"
                class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-purple-500 focus:ring-4 focus:ring-purple-100 transition-all outline-none">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                <span class="mr-2">üîê</span>‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô
              </label>
              <input type="password" id="teacher-password" required placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô"
                class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-purple-500 focus:ring-4 focus:ring-purple-100 transition-all outline-none">
            </div>
            <button type="submit" class="w-full py-4 bg-gradient-to-r from-purple-500 to-purple-600 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all duration-300">
              ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏£‡∏π üîì
            </button>
          </form>
          
          <!-- Decorative Footer -->
          <div class="mt-6 pt-6 border-t border-gray-100 text-center">
            <div class="flex justify-center gap-3 text-2xl">
              <span class="bounce-slow" style="animation-delay: 0s;">üå∏</span>
              <span class="bounce-slow" style="animation-delay: 0.2s;">üåª</span>
              <span class="bounce-slow" style="animation-delay: 0.4s;">üå∫</span>
              <span class="bounce-slow" style="animation-delay: 0.6s;">üå∑</span>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Student Dashboard -->
    <div id="student-page" class="hidden min-h-full">
      <!-- Header -->
      <header class="bg-white/80 backdrop-blur-lg shadow-sm sticky top-0 z-40 border-b border-white/50">
        <div class="max-w-4xl mx-auto px-4 py-4 flex items-center justify-between">
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center shadow-md">
              <span class="text-xl">üéì</span>
            </div>
            <div>
              <h2 class="font-semibold text-gray-800">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ, <span id="student-name-display">‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</span></h2>
              <p class="text-xs text-gray-500">‡∏£‡∏´‡∏±‡∏™: <span id="student-id-display">-</span></p>
            </div>
          </div>
          <button onclick="logout()" class="px-4 py-2 bg-red-100 text-red-600 rounded-xl hover:bg-red-200 transition-colors font-medium">
            ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö üö™
          </button>
        </div>
      </header>
      
      <!-- Student Content -->
      <main class="max-w-4xl mx-auto px-4 py-6">
        <!-- Tab Navigation -->
        <div class="flex bg-white/80 backdrop-blur rounded-2xl p-1 mb-6 shadow-sm">
          <button onclick="switchStudentTab('request')" id="student-tab-request" class="flex-1 py-3 px-4 rounded-xl font-medium transition-all duration-300 bg-blue-500 text-white shadow-md">
            üìù ‡∏Ç‡∏≠‡∏•‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡∏ö‡πâ‡∏≤‡∏ô
          </button>
          <button onclick="switchStudentTab('history')" id="student-tab-history" class="flex-1 py-3 px-4 rounded-xl font-medium transition-all duration-300 text-gray-600 hover:text-gray-800">
            üìã ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Ñ‡∏≥‡∏Ç‡∏≠
          </button>
        </div>
        
        <!-- Request Form -->
        <div id="student-request-section" class="bg-white/90 backdrop-blur rounded-3xl card-shadow p-6 border border-white/50">
          <div class="flex items-center gap-3 mb-6">
            <div class="w-12 h-12 bg-gradient-to-br from-green-400 to-green-600 rounded-2xl flex items-center justify-center shadow-lg">
              <span class="text-2xl">üìù</span>
            </div>
            <div>
              <h3 class="text-xl font-bold text-gray-800">‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ç‡∏≠‡∏•‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡∏ö‡πâ‡∏≤‡∏ô</h3>
              <p class="text-sm text-gray-500">‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô</p>
            </div>
          </div>
          
          <form id="leave-request-form" onsubmit="submitLeaveRequest(event)" class="space-y-5">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  <span class="mr-2">üë§</span>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•
                </label>
                <input type="text" id="request-name" required placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•"
                  class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:ring-4 focus:ring-blue-100 transition-all outline-none">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  <span class="mr-2">üèõÔ∏è</span>‡∏ä‡∏±‡πâ‡∏ô/‡∏´‡πâ‡∏≠‡∏á
                </label>
                <input type="text" id="request-class" required placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏°.3/1"
                  class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:ring-4 focus:ring-blue-100 transition-all outline-none">
              </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  <span class="mr-2">üìÖ</span>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏≤
                </label>
                <input type="date" id="request-date" required
                  class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:ring-4 focus:ring-blue-100 transition-all outline-none">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  <span class="mr-2">‚è∞</span>‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å
                </label>
                <input type="time" id="request-time-out" required
                  class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:ring-4 focus:ring-blue-100 transition-all outline-none">
              </div>
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                <span class="mr-2">üîô</span>‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏•‡∏±‡∏ö (‡∏ñ‡πâ‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏≠‡∏µ‡∏Å - ‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)
              </label>
              <input type="time" id="request-time-back" placeholder="‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö"
                class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:ring-4 focus:ring-blue-100 transition-all outline-none">
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                <span class="mr-2">üìã</span>‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏≤
              </label>
              <textarea id="request-reason" required rows="3" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏≤..."
                class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:ring-4 focus:ring-blue-100 transition-all outline-none resize-none"></textarea>
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                <span class="mr-2">üì∏</span>‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏≤‡∏£‡∏±‡∏ö
              </label>
              <div class="border-2 border-dashed border-gray-300 rounded-xl p-6 text-center hover:border-blue-400 transition-colors cursor-pointer" onclick="document.getElementById('parent-photo').click()">
                <input type="file" id="parent-photo" accept="image/*" capture="environment" class="hidden" onchange="handlePhotoUpload(event)">
                <div id="photo-preview-container" class="hidden">
                  <img id="photo-preview" class="max-h-48 mx-auto rounded-xl shadow-md">
                  <p class="text-sm text-green-600 mt-2">‚úÖ ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢</p>
                </div>
                <div id="photo-placeholder">
                  <div class="text-4xl mb-2">üì∑</div>
                  <p class="text-gray-500">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå</p>
                  <p class="text-xs text-gray-400 mt-1">‡∏£‡∏π‡∏õ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</p>
                </div>
              </div>
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                <span class="mr-2">üìû</span>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á
              </label>
              <input type="tel" id="request-parent-phone" required placeholder="‡πÄ‡∏ä‡πà‡∏ô 0812345678"
                class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:ring-4 focus:ring-blue-100 transition-all outline-none">
            </div>
            
            <button type="submit" id="submit-request-btn" class="w-full py-4 bg-gradient-to-r from-green-500 to-green-600 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all duration-300 flex items-center justify-center gap-2">
              <span>‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏•‡∏≤</span>
              <span class="text-xl">üì§</span>
            </button>
          </form>
        </div>
        
        <!-- History Section -->
        <div id="student-history-section" class="hidden bg-white/90 backdrop-blur rounded-3xl card-shadow p-6 border border-white/50">
          <div class="flex items-center gap-3 mb-6">
            <div class="w-12 h-12 bg-gradient-to-br from-purple-400 to-purple-600 rounded-2xl flex items-center justify-center shadow-lg">
              <span class="text-2xl">üìã</span>
            </div>
            <div>
              <h3 class="text-xl font-bold text-gray-800">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h3>
              <p class="text-sm text-gray-500">‡∏î‡∏π‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
            </div>
          </div>
          
          <div id="student-history-list" class="space-y-4 max-h-96 overflow-auto custom-scrollbar">
            <div class="text-center py-8 text-gray-400">
              <div class="text-4xl mb-2">üì≠</div>
              <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Ñ‡∏≥‡∏Ç‡∏≠</p>
            </div>
          </div>
        </div>
      </main>
    </div>
    
    <!-- Teacher Dashboard -->
    <div id="teacher-page" class="hidden min-h-full">
      <!-- Header -->
      <header class="bg-white/80 backdrop-blur-lg shadow-sm sticky top-0 z-40 border-b border-white/50">
        <div class="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between">
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-gradient-to-br from-purple-500 to-pink-600 rounded-full flex items-center justify-center shadow-md">
              <span class="text-xl">üë®‚Äçüè´</span>
            </div>
            <div>
              <h2 class="font-semibold text-gray-800">‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô</h2>
              <p class="text-xs text-gray-500">‡∏Ñ‡∏£‡∏π/‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£</p>
            </div>
          </div>
          <div class="flex items-center gap-3">
            <div id="notification-badge" class="hidden relative">
              <span class="absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center notification-badge">0</span>
              <span class="text-2xl">üîî</span>
            </div>
            <button onclick="logout()" class="px-4 py-2 bg-red-100 text-red-600 rounded-xl hover:bg-red-200 transition-colors font-medium">
              ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö üö™
            </button>
          </div>
        </div>
      </header>
      
      <!-- Teacher Content -->
      <main class="max-w-6xl mx-auto px-4 py-6">
        <!-- Stats Cards -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
          <div class="bg-white/90 backdrop-blur rounded-2xl p-4 shadow-sm border border-white/50">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 bg-yellow-100 rounded-xl flex items-center justify-center">
                <span class="text-xl">‚è≥</span>
              </div>
              <div>
                <p class="text-2xl font-bold text-yellow-600" id="stat-pending">0</p>
                <p class="text-xs text-gray-500">‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</p>
              </div>
            </div>
          </div>
          <div class="bg-white/90 backdrop-blur rounded-2xl p-4 shadow-sm border border-white/50">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 bg-green-100 rounded-xl flex items-center justify-center">
                <span class="text-xl">‚úÖ</span>
              </div>
              <div>
                <p class="text-2xl font-bold text-green-600" id="stat-approved">0</p>
                <p class="text-xs text-gray-500">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</p>
              </div>
            </div>
          </div>
          <div class="bg-white/90 backdrop-blur rounded-2xl p-4 shadow-sm border border-white/50">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 bg-red-100 rounded-xl flex items-center justify-center">
                <span class="text-xl">‚ùå</span>
              </div>
              <div>
                <p class="text-2xl font-bold text-red-600" id="stat-rejected">0</p>
                <p class="text-xs text-gray-500">‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</p>
              </div>
            </div>
          </div>
          <div class="bg-white/90 backdrop-blur rounded-2xl p-4 shadow-sm border border-white/50">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 bg-blue-100 rounded-xl flex items-center justify-center">
                <span class="text-xl">üìä</span>
              </div>
              <div>
                <p class="text-2xl font-bold text-blue-600" id="stat-total">0</p>
                <p class="text-xs text-gray-500">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Filter Section -->
        <div class="bg-white/90 backdrop-blur rounded-2xl p-4 mb-6 shadow-sm border border-white/50">
          <div class="flex flex-wrap items-center gap-3">
            <span class="text-sm font-medium text-gray-600">üîç ‡∏Å‡∏£‡∏≠‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</span>
            <button onclick="filterRequests('all')" id="filter-all" class="px-4 py-2 bg-blue-500 text-white rounded-xl text-sm font-medium transition-all">
              ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            </button>
            <button onclick="filterRequests('pending')" id="filter-pending" class="px-4 py-2 bg-gray-100 text-gray-600 rounded-xl text-sm font-medium hover:bg-gray-200 transition-all">
              ‚è≥ ‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
            </button>
            <button onclick="filterRequests('approved')" id="filter-approved" class="px-4 py-2 bg-gray-100 text-gray-600 rounded-xl text-sm font-medium hover:bg-gray-200 transition-all">
              ‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß
            </button>
            <button onclick="filterRequests('rejected')" id="filter-rejected" class="px-4 py-2 bg-gray-100 text-gray-600 rounded-xl text-sm font-medium hover:bg-gray-200 transition-all">
              ‚ùå ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
            </button>
          </div>
        </div>
        
        <!-- Requests List -->
        <div class="bg-white/90 backdrop-blur rounded-3xl card-shadow p-6 border border-white/50">
          <div class="flex items-center justify-between mb-6">
            <div class="flex items-center gap-3">
              <div class="w-12 h-12 bg-gradient-to-br from-indigo-400 to-indigo-600 rounded-2xl flex items-center justify-center shadow-lg">
                <span class="text-2xl">üìã</span>
              </div>
              <div>
                <h3 class="text-xl font-bold text-gray-800">‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏•‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
                <p class="text-sm text-gray-500">‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå</p>
              </div>
            </div>
            <div class="flex items-center gap-2 text-sm text-green-600">
              <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
              ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß
            </div>
          </div>
          
          <div id="teacher-requests-list" class="space-y-4 max-h-[600px] overflow-auto custom-scrollbar">
            <div class="text-center py-12 text-gray-400">
              <div class="text-5xl mb-3">üì≠</div>
              <p class="text-lg">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏•‡∏≤</p>
              <p class="text-sm">‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÉ‡∏´‡∏°‡πà‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå</p>
            </div>
          </div>
        </div>
      </main>
    </div>
    
    <!-- Reject Modal -->
    <div id="reject-modal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4">
      <div class="bg-white rounded-3xl card-shadow p-6 w-full max-w-md">
        <div class="flex items-center gap-3 mb-4">
          <div class="w-12 h-12 bg-red-100 rounded-2xl flex items-center justify-center">
            <span class="text-2xl">‚ùå</span>
          </div>
          <div>
            <h3 class="text-lg font-bold text-gray-800">‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Ñ‡∏≥‡∏Ç‡∏≠</h3>
            <p class="text-sm text-gray-500">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•</p>
          </div>
        </div>
        <textarea id="reject-reason" rows="3" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥..."
          class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-red-500 focus:ring-4 focus:ring-red-100 transition-all outline-none resize-none mb-4"></textarea>
        <div class="flex gap-3">
          <button onclick="closeRejectModal()" class="flex-1 py-3 bg-gray-100 text-gray-600 rounded-xl font-medium hover:bg-gray-200 transition-colors">
            ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
          </button>
          <button onclick="confirmReject()" class="flex-1 py-3 bg-red-500 text-white rounded-xl font-medium hover:bg-red-600 transition-colors">
            ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
          </button>
        </div>
      </div>
    </div>
    
    <!-- Image View Modal -->
    <div id="image-modal" class="hidden fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4" onclick="closeImageModal()">
      <div class="relative max-w-4xl max-h-full">
        <img id="modal-image" class="max-w-full max-h-[80vh] rounded-2xl shadow-2xl">
        <button onclick="closeImageModal()" class="absolute top-4 right-4 w-10 h-10 bg-white/20 backdrop-blur rounded-full flex items-center justify-center text-white hover:bg-white/30 transition-colors">
          ‚úï
        </button>
      </div>
    </div>
    
  </div>

  <script>
    // ============================================
    // üî• Firebase Configuration
    // ============================================
    // ‚ö†Ô∏è ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà Firebase Config ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
    // ‡∏ß‡∏¥‡∏ò‡∏µ‡∏£‡∏±‡∏ö Config:
    // 1. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà Firebase Console (https://console.firebase.google.com)
    // 2. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Project ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
    // 3. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà Project Settings > General
    // 4. ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏•‡∏á‡πÑ‡∏õ‡∏´‡∏≤ "Your apps" > ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Web app
    // 5. ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å firebaseConfig ‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á
    
    const firebaseConfig = {
      // ================================
      // ‚ö†Ô∏è ‡πÉ‡∏™‡πà Config ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà ‚ö†Ô∏è
      // ================================
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };
    
    // Initialize Firebase
    let db = null;
    let unsubscribeRequests = null;
    
    try {
      firebase.initializeApp(firebaseConfig);
      db = firebase.firestore();
      console.log('‚úÖ Firebase connected successfully');
    } catch (error) {
      console.error('‚ùå Firebase connection error:', error);
      showToast('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Firebase ‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Config', 'error');
    }
    
    // ============================================
    // üéØ App State
    // ============================================
    let currentUser = null;
    let currentUserType = null;
    let allRequests = [];
    let currentFilter = 'all';
    let pendingRejectId = null;
    let compressedPhotoData = null;
    
    // Teacher credentials (‡∏á‡πà‡∏≤‡∏¢‡πÜ ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö demo)
    const TEACHER_CREDENTIALS = {
      username: 'teacher',
      password: '1234'
    };
    
    // ============================================
    // üîê Authentication Functions
    // ============================================
    function switchLoginType(type) {
      const studentForm = document.getElementById('student-login-form');
      const teacherForm = document.getElementById('teacher-login-form');
      const tabStudent = document.getElementById('tab-student');
      const tabTeacher = document.getElementById('tab-teacher');
      
      if (type === 'student') {
        studentForm.classList.remove('hidden');
        teacherForm.classList.add('hidden');
        tabStudent.className = 'flex-1 py-3 px-4 rounded-xl font-medium transition-all duration-300 bg-white shadow-md text-blue-600';
        tabTeacher.className = 'flex-1 py-3 px-4 rounded-xl font-medium transition-all duration-300 text-gray-500 hover:text-gray-700';
      } else {
        studentForm.classList.add('hidden');
        teacherForm.classList.remove('hidden');
        tabTeacher.className = 'flex-1 py-3 px-4 rounded-xl font-medium transition-all duration-300 bg-white shadow-md text-purple-600';
        tabStudent.className = 'flex-1 py-3 px-4 rounded-xl font-medium transition-all duration-300 text-gray-500 hover:text-gray-700';
      }
    }
    
    function handleStudentLogin(event) {
      event.preventDefault();
      const studentId = document.getElementById('student-id').value.trim();
      const idCard = document.getElementById('student-id-card').value.trim();
      
      if (!studentId || !idCard) {
        showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö', 'error');
        return;
      }
      
      if (idCard.length !== 4) {
        showToast('‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ 4 ‡∏´‡∏•‡∏±‡∏Å', 'error');
        return;
      }
      
      currentUser = { studentId, idCard };
      currentUserType = 'student';
      
      document.getElementById('student-id-display').textContent = studentId;
      
      showPage('student');
      loadStudentHistory();
      setTodayDate();
      showToast('‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! üéâ', 'success');
    }
    
    function handleTeacherLogin(event) {
      event.preventDefault();
      const username = document.getElementById('teacher-username').value.trim();
      const password = document.getElementById('teacher-password').value;
      
      if (username === TEACHER_CREDENTIALS.username && password === TEACHER_CREDENTIALS.password) {
        currentUser = { username };
        currentUserType = 'teacher';
        
        showPage('teacher');
        startRealtimeListener();
        showToast('‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏£‡∏π‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! üë®‚Äçüè´', 'success');
      } else {
        showToast('‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'error');
      }
    }
    
    function logout() {
      if (unsubscribeRequests) {
        unsubscribeRequests();
        unsubscribeRequests = null;
      }
      
      currentUser = null;
      currentUserType = null;
      allRequests = [];
      
      document.getElementById('student-login-form').reset();
      document.getElementById('teacher-login-form').reset();
      document.getElementById('leave-request-form').reset();
      resetPhotoUpload();
      
      showPage('login');
      showToast('‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß', 'info');
    }
    
    // ============================================
    // üìÑ Page Navigation
    // ============================================
    function showPage(page) {
      document.getElementById('login-page').classList.add('hidden');
      document.getElementById('student-page').classList.add('hidden');
      document.getElementById('teacher-page').classList.add('hidden');
      
      if (page === 'login') {
        document.getElementById('login-page').classList.remove('hidden');
      } else if (page === 'student') {
        document.getElementById('student-page').classList.remove('hidden');
      } else if (page === 'teacher') {
        document.getElementById('teacher-page').classList.remove('hidden');
      }
    }
    
    function switchStudentTab(tab) {
      const requestSection = document.getElementById('student-request-section');
      const historySection = document.getElementById('student-history-section');
      const tabRequest = document.getElementById('student-tab-request');
      const tabHistory = document.getElementById('student-tab-history');
      
      if (tab === 'request') {
        requestSection.classList.remove('hidden');
        historySection.classList.add('hidden');
        tabRequest.className = 'flex-1 py-3 px-4 rounded-xl font-medium transition-all duration-300 bg-blue-500 text-white shadow-md';
        tabHistory.className = 'flex-1 py-3 px-4 rounded-xl font-medium transition-all duration-300 text-gray-600 hover:text-gray-800';
      } else {
        requestSection.classList.add('hidden');
        historySection.classList.remove('hidden');
        tabHistory.className = 'flex-1 py-3 px-4 rounded-xl font-medium transition-all duration-300 bg-purple-500 text-white shadow-md';
        tabRequest.className = 'flex-1 py-3 px-4 rounded-xl font-medium transition-all duration-300 text-gray-600 hover:text-gray-800';
        loadStudentHistory();
      }
    }
    
    // ============================================
    // üì∑ Photo Handling with Compression
    // ============================================
    async function handlePhotoUpload(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      showToast('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û...', 'info');
      
      try {
        const compressed = await compressImage(file, 800, 0.7);
        compressedPhotoData = compressed;
        
        document.getElementById('photo-preview').src = compressed;
        document.getElementById('photo-preview-container').classList.remove('hidden');
        document.getElementById('photo-placeholder').classList.add('hidden');
        
        showToast('‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! üì∏', 'success');
      } catch (error) {
        console.error('Photo compression error:', error);
        showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ', 'error');
      }
    }
    
    function compressImage(file, maxWidth, quality) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = function(e) {
          const img = new Image();
          img.onload = function() {
            const canvas = document.createElement('canvas');
            let width = img.width;
            let height = img.height;
            
            if (width > maxWidth) {
              height = (height * maxWidth) / width;
              width = maxWidth;
            }
            
            canvas.width = width;
            canvas.height = height;
            
            const ctx = canvas.getContext('2d');
            ctx.drawImage(img, 0, 0, width, height);
            
            resolve(canvas.toDataURL('image/jpeg', quality));
          };
          img.onerror = reject;
          img.src = e.target.result;
        };
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }
    
    function resetPhotoUpload() {
      compressedPhotoData = null;
      document.getElementById('parent-photo').value = '';
      document.getElementById('photo-preview-container').classList.add('hidden');
      document.getElementById('photo-placeholder').classList.remove('hidden');
    }
    
    // ============================================
    // üìù Leave Request Functions
    // ============================================
    function setTodayDate() {
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('request-date').value = today;
    }
    
    async function submitLeaveRequest(event) {
      event.preventDefault();
      
      if (!db) {
        showToast('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ', 'error');
        return;
      }
      
      const submitBtn = document.getElementById('submit-request-btn');
      submitBtn.disabled = true;
      submitBtn.innerHTML = '<span class="animate-spin">‚è≥</span> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á...';
      
      try {
        const requestData = {
          studentId: currentUser.studentId,
          name: document.getElementById('request-name').value.trim(),
          className: document.getElementById('request-class').value.trim(),
          date: document.getElementById('request-date').value,
          timeOut: document.getElementById('request-time-out').value,
          timeBack: document.getElementById('request-time-back').value || null,
          reason: document.getElementById('request-reason').value.trim(),
          parentPhone: document.getElementById('request-parent-phone').value.trim(),
          parentPhoto: compressedPhotoData || null,
          status: 'pending',
          createdAt: firebase.firestore.FieldValue.serverTimestamp(),
          updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
          rejectReason: null
        };
        
        await db.collection('leave_requests').add(requestData);
        
        document.getElementById('leave-request-form').reset();
        resetPhotoUpload();
        setTodayDate();
        
        showToast('‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏•‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏à‡∏≤‡∏Å‡∏Ñ‡∏£‡∏π üì§', 'success');
        
        switchStudentTab('history');
        
      } catch (error) {
        console.error('Submit error:', error);
        showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message, 'error');
      } finally {
        submitBtn.disabled = false;
        submitBtn.innerHTML = '<span>‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏•‡∏≤</span><span class="text-xl">üì§</span>';
      }
    }
    
    // ============================================
    // üìã Student History
    // ============================================
    function loadStudentHistory() {
      if (!db || !currentUser) return;
      
      const historyList = document.getElementById('student-history-list');
      historyList.innerHTML = '<div class="text-center py-8"><div class="animate-spin text-3xl">‚è≥</div><p class="text-gray-400 mt-2">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p></div>';
      
      db.collection('leave_requests')
        .where('studentId', '==', currentUser.studentId)
        .orderBy('createdAt', 'desc')
        .onSnapshot((snapshot) => {
          const requests = [];
          snapshot.forEach(doc => {
            requests.push({ id: doc.id, ...doc.data() });
          });
          
          renderStudentHistory(requests);
        }, (error) => {
          console.error('History load error:', error);
          historyList.innerHTML = '<div class="text-center py-8 text-red-400"><div class="text-3xl mb-2">‚ùå</div><p>‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p></div>';
        });
    }
    
    function renderStudentHistory(requests) {
      const historyList = document.getElementById('student-history-list');
      
      if (requests.length === 0) {
        historyList.innerHTML = '<div class="text-center py-8 text-gray-400"><div class="text-4xl mb-2">üì≠</div><p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Ñ‡∏≥‡∏Ç‡∏≠</p></div>';
        return;
      }
      
      historyList.innerHTML = requests.map(req => {
        const statusConfig = getStatusConfig(req.status);
        const date = req.createdAt ? new Date(req.createdAt.seconds * 1000).toLocaleDateString('th-TH') : req.date;
        
        return `
          <div class="bg-gradient-to-r ${statusConfig.gradient} p-4 rounded-2xl border ${statusConfig.border}">
            <div class="flex items-start justify-between mb-3">
              <div class="flex items-center gap-2">
                <span class="text-xl">${statusConfig.icon}</span>
                <span class="font-medium ${statusConfig.textColor}">${statusConfig.label}</span>
              </div>
              <span class="text-sm text-gray-500">${date}</span>
            </div>
            <div class="space-y-1 text-sm">
              <p><span class="text-gray-500">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏≤:</span> ${req.date}</p>
              <p><span class="text-gray-500">‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏≠‡∏Å:</span> ${req.timeOut} ‡∏ô.</p>
              ${req.timeBack ? `<p><span class="text-gray-500">‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏•‡∏±‡∏ö:</span> ${req.timeBack} ‡∏ô.</p>` : ''}
              <p><span class="text-gray-500">‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•:</span> ${req.reason}</p>
              ${req.status === 'rejected' && req.rejectReason ? `<p class="text-red-600"><span class="text-gray-500">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</span> ${req.rejectReason}</p>` : ''}
            </div>
          </div>
        `;
      }).join('');
    }
    
    // ============================================
    // üë®‚Äçüè´ Teacher Functions
    // ============================================
    function startRealtimeListener() {
      if (!db) {
        showToast('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ', 'error');
        return;
      }
      
      unsubscribeRequests = db.collection('leave_requests')
        .orderBy('createdAt', 'desc')
        .onSnapshot((snapshot) => {
          const previousPending = allRequests.filter(r => r.status === 'pending').length;
          
          allRequests = [];
          snapshot.forEach(doc => {
            allRequests.push({ id: doc.id, ...doc.data() });
          });
          
          const currentPending = allRequests.filter(r => r.status === 'pending').length;
          
          // ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÉ‡∏´‡∏°‡πà
          if (currentPending > previousPending && previousPending > 0) {
            showToast('üîî ‡∏°‡∏µ‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏•‡∏≤‡πÉ‡∏´‡∏°‡πà!', 'info');
            playNotificationSound();
          }
          
          updateStats();
          renderTeacherRequests();
        }, (error) => {
          console.error('Realtime listener error:', error);
          showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', 'error');
        });
    }
    
    function updateStats() {
      const pending = allRequests.filter(r => r.status === 'pending').length;
      const approved = allRequests.filter(r => r.status === 'approved').length;
      const rejected = allRequests.filter(r => r.status === 'rejected').length;
      
      document.getElementById('stat-pending').textContent = pending;
      document.getElementById('stat-approved').textContent = approved;
      document.getElementById('stat-rejected').textContent = rejected;
      document.getElementById('stat-total').textContent = allRequests.length;
      
      // Update notification badge
      const badge = document.getElementById('notification-badge');
      if (pending > 0) {
        badge.classList.remove('hidden');
        badge.querySelector('span').textContent = pending;
      } else {
        badge.classList.add('hidden');
      }
    }
    
    function filterRequests(filter) {
      currentFilter = filter;
      
      // Update filter buttons
      ['all', 'pending', 'approved', 'rejected'].forEach(f => {
        const btn = document.getElementById(`filter-${f}`);
        if (f === filter) {
          btn.className = 'px-4 py-2 bg-blue-500 text-white rounded-xl text-sm font-medium transition-all';
        } else {
          btn.className = 'px-4 py-2 bg-gray-100 text-gray-600 rounded-xl text-sm font-medium hover:bg-gray-200 transition-all';
        }
      });
      
      renderTeacherRequests();
    }
    
    function renderTeacherRequests() {
      const listContainer = document.getElementById('teacher-requests-list');
      
      let filteredRequests = allRequests;
      if (currentFilter !== 'all') {
        filteredRequests = allRequests.filter(r => r.status === currentFilter);
      }
      
      if (filteredRequests.length === 0) {
        listContainer.innerHTML = `
          <div class="text-center py-12 text-gray-400">
            <div class="text-5xl mb-3">üì≠</div>
            <p class="text-lg">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏Ç‡∏≠${currentFilter !== 'all' ? '‡πÉ‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ô‡∏µ‡πâ' : ''}</p>
          </div>
        `;
        return;
      }
      
      listContainer.innerHTML = filteredRequests.map(req => {
        const statusConfig = getStatusConfig(req.status);
        const createdDate = req.createdAt ? new Date(req.createdAt.seconds * 1000) : new Date();
        const dateStr = createdDate.toLocaleDateString('th-TH');
        const timeStr = createdDate.toLocaleTimeString('th-TH', { hour: '2-digit', minute: '2-digit' });
        
        return `
          <div class="bg-white border-2 ${statusConfig.border} rounded-2xl p-5 shadow-sm hover:shadow-md transition-shadow">
            <div class="flex items-start justify-between mb-4">
              <div class="flex items-center gap-3">
                <div class="w-12 h-12 bg-gradient-to-br from-blue-400 to-blue-600 rounded-xl flex items-center justify-center text-white font-bold shadow-md">
                  ${req.name.charAt(0)}
                </div>
                <div>
                  <h4 class="font-semibold text-gray-800">${req.name}</h4>
                  <p class="text-sm text-gray-500">‡∏£‡∏´‡∏±‡∏™: ${req.studentId} | ${req.className}</p>
                </div>
              </div>
              <div class="text-right">
                <span class="inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm font-medium ${statusConfig.bgColor} ${statusConfig.textColor}">
                  ${statusConfig.icon} ${statusConfig.label}
                </span>
                <p class="text-xs text-gray-400 mt-1">${dateStr} ${timeStr}</p>
              </div>
            </div>
            
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-4 text-sm">
              <div class="bg-gray-50 rounded-xl p-3">
                <p class="text-gray-500 text-xs">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏≤</p>
                <p class="font-medium">${req.date}</p>
              </div>
              <div class="bg-gray-50 rounded-xl p-3">
                <p class="text-gray-500 text-xs">‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏≠‡∏Å</p>
                <p class="font-medium">${req.timeOut} ‡∏ô.</p>
              </div>
              <div class="bg-gray-50 rounded-xl p-3">
                <p class="text-gray-500 text-xs">‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏•‡∏±‡∏ö</p>
                <p class="font-medium">${req.timeBack || '-'}</p>
              </div>
              <div class="bg-gray-50 rounded-xl p-3">
                <p class="text-gray-500 text-xs">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á</p>
                <p class="font-medium">${req.parentPhone}</p>
              </div>
            </div>
            
            <div class="bg-gray-50 rounded-xl p-3 mb-4">
              <p class="text-gray-500 text-xs mb-1">‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•</p>
              <p class="text-gray-800">${req.reason}</p>
            </div>
            
            ${req.parentPhoto ? `
              <div class="mb-4">
                <p class="text-gray-500 text-xs mb-2">üì∏ ‡∏£‡∏π‡∏õ‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á</p>
                <img src="${req.parentPhoto}" class="h-24 rounded-xl shadow-sm cursor-pointer hover:opacity-90 transition-opacity" onclick="viewImage('${req.parentPhoto}')" alt="‡∏£‡∏π‡∏õ‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á" loading="lazy" onerror="this.style.background='#e5e7eb'; this.alt='Image unavailable';">
              </div>
            ` : ''}
            
            ${req.status === 'rejected' && req.rejectReason ? `
              <div class="bg-red-50 rounded-xl p-3 mb-4 border border-red-200">
                <p class="text-red-500 text-xs mb-1">‚ùå ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</p>
                <p class="text-red-700">${req.rejectReason}</p>
              </div>
            ` : ''}
            
            ${req.status === 'pending' ? `
              <div class="flex gap-3">
                <button onclick="approveRequest('${req.id}')" class="flex-1 py-3 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-xl font-medium hover:shadow-lg transform hover:-translate-y-0.5 transition-all">
                  ‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
                </button>
                <button onclick="openRejectModal('${req.id}')" class="flex-1 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-xl font-medium hover:shadow-lg transform hover:-translate-y-0.5 transition-all">
                  ‚ùå ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
                </button>
              </div>
            ` : ''}
          </div>
        `;
      }).join('');
    }
    
    async function approveRequest(id) {
      if (!db) return;
      
      try {
        await db.collection('leave_requests').doc(id).update({
          status: 'approved',
          updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        showToast('‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢! ‚úÖ', 'success');
      } catch (error) {
        console.error('Approve error:', error);
        showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message, 'error');
      }
    }
    
    function openRejectModal(id) {
      pendingRejectId = id;
      document.getElementById('reject-reason').value = '';
      document.getElementById('reject-modal').classList.remove('hidden');
    }
    
    function closeRejectModal() {
      pendingRejectId = null;
      document.getElementById('reject-modal').classList.add('hidden');
    }
    
    async function confirmReject() {
      if (!db || !pendingRejectId) return;
      
      const reason = document.getElementById('reject-reason').value.trim();
      if (!reason) {
        showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥', 'error');
        return;
      }
      
      try {
        await db.collection('leave_requests').doc(pendingRejectId).update({
          status: 'rejected',
          rejectReason: reason,
          updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        closeRejectModal();
        showToast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
      } catch (error) {
        console.error('Reject error:', error);
        showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message, 'error');
      }
    }
    
    // ============================================
    // üñºÔ∏è Image Modal
    // ============================================
    function viewImage(src) {
      document.getElementById('modal-image').src = src;
      document.getElementById('image-modal').classList.remove('hidden');
    }
    
    function closeImageModal() {
      document.getElementById('image-modal').classList.add('hidden');
    }
    
    // ============================================
    // üîî Notification Functions
    // ============================================
    function showToast(message, type = 'info') {
      const container = document.getElementById('toast-container');
      const toast = document.createElement('div');
      
      const colors = {
        success: 'bg-green-500',
        error: 'bg-red-500',
        info: 'bg-blue-500',
        warning: 'bg-yellow-500'
      };
      
      const icons = {
        success: '‚úÖ',
        error: '‚ùå',
        info: '‚ÑπÔ∏è',
        warning: '‚ö†Ô∏è'
      };
      
      toast.className = `toast ${colors[type]} text-white px-4 py-3 rounded-xl shadow-lg flex items-center gap-2 min-w-[250px]`;
      toast.innerHTML = `<span>${icons[type]}</span><span>${message}</span>`;
      
      container.appendChild(toast);
      
      setTimeout(() => toast.classList.add('show'), 10);
      
      setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }
    
    function playNotificationSound() {
      // Simple beep using Web Audio API
      try {
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        
        oscillator.frequency.value = 800;
        oscillator.type = 'sine';
        gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
        
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 0.3);
      } catch (e) {
        // Silently fail if audio is not supported
      }
    }
    
    // ============================================
    // üé® Status Config Helper
    // ============================================
    function getStatusConfig(status) {
      const configs = {
        pending: {
          label: 
